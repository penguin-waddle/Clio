<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Clio — Shared List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#faf8f6; --card:#fff; --text:#222; --muted:#667085; --accent:#6b5cff; --accent-ink:#fff; --ring:rgba(107,92,255,0.2);}
    *{box-sizing:border-box}
    body{margin:0;padding:24px;font-family:-apple-system,system-ui,"SF Pro Text",Inter,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 800px at 20% -10%, #efeaff 0%, transparent 60%), var(--bg);color:var(--text)}
    .container{max-width:720px;margin:0 auto}
    .card{background:var(--card);border-radius:16px;padding:28px;box-shadow:0 10px 30px rgba(0,0,0,0.06);border:1px solid rgba(0,0,0,0.04)}
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:18px;color:var(--muted);font-weight:600;letter-spacing:.2px}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 6px var(--ring)}
    h1{margin:0 0 8px 0;font-size:28px;line-height:1.2;letter-spacing:-.3px}
    p.desc{margin:0 0 20px 0;color:var(--muted)}
    .actions{display:flex;gap:12px;flex-wrap:wrap}
    .btn{appearance:none;border:none;cursor:pointer;padding:12px 16px;border-radius:12px;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;gap:8px;box-shadow:0 2px 0 rgba(0,0,0,0.05)}
    .btn-primary{background:var(--accent);color:var(--accent-ink)}
    .btn-secondary{background:#f3f4f6;color:#111827}
    .footnote{margin-top:14px;color:var(--muted);font-size:13px}
    .list-meta{margin-top:18px;color:var(--muted);font-size:14px}
    .notice{margin-top:24px;font-size:14px;color:var(--muted);background:#f8fafc;border:1px dashed #e5e7eb;padding:12px;border-radius:12px}
    .preview{margin-top:24px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px}
    .card-book{background:#fff;border:1px solid rgba(0,0,0,0.06);border-radius:12px;padding:12px;display:flex;gap:12px}
    .cover{width:56px;height:84px;border-radius:8px;object-fit:cover;background:#f1f1f1}
    .book-title{font-weight:600;margin:0 0 4px 0}
    .book-author{margin:0;color:#6b7280;font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <div class="brand"><span class="dot"></span> Clio</div>
    <div class="card">
      <h1 id="title">Loading…</h1>
      <p id="desc" class="desc"></p>

      <div class="actions">
        <a id="openAppBtn" class="btn btn-primary" href="#">Open in Clio</a>
        <button id="copyBtn" class="btn btn-secondary">Copy link</button>
      </div>

      <div id="preview" class="preview"></div>

      <div class="list-meta" id="meta"></div>
      <div class="notice">
        Tip: If you don’t have the app installed yet, you can find it on the App Store soon.
      </div>
    </div>
  </div>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBwu8bFmIbMm3fxdyxS_tMxk7Lhr9cFnHQ",
      authDomain: "clioapp-1dc1f.firebaseapp.com",
      projectId: "clioapp-1dc1f",
      storageBucket: "clioapp-1dc1f.appspot.com",
      messagingSenderId: "221047970538",
      appId: "1:221047970538:ios:60ebb91c4e06a08744ed02"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function getShareID() {
      const parts = (window.location.hash || "").split("/");
      return parts[parts.length - 1] || "";
    }
    const shareID = getShareID();
    const webURL = `${location.origin}/#/list/${shareID}`;

    db.collection("readingLists").doc(shareID).get().then((doc) => {
      if (!doc.exists) {
        document.getElementById("title").innerText = "List not found";
        return;
      }
      const data = doc.data();
      document.getElementById("title").innerText = data.title || "Shared List";
      document.getElementById("desc").innerText = data.description || "";
      document.getElementById("meta").innerText = data.isPublic ? "Public list" : "";

      // Open in app deep link
      const schemeURL = `clioapp://list/${shareID}`;
      const btn = document.getElementById("openAppBtn");
      btn.href = schemeURL;

      // Copy link handler
      document.getElementById("copyBtn").addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(webURL);
          document.getElementById("copyBtn").innerText = "Copied!";
          setTimeout(() => (document.getElementById("copyBtn").innerText = "Copy link"), 1500);
        } catch {
          const ta = document.createElement("textarea");
          ta.value = webURL;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          document.getElementById("copyBtn").innerText = "Copied!";
          setTimeout(() => (document.getElementById("copyBtn").innerText = "Copy link"), 1500);
        }
      });

      // Load preview books (up to 3)
      db.collection("readingLists").doc(shareID).collection("previewBooks")
        .limit(3)
        .get()
        .then((snap) => {
          const container = document.getElementById("preview");
          if (snap.empty) return;
          snap.forEach((d) => {
            const b = d.data();
            const el = document.createElement("div");
            el.className = "card-book";
            const img = document.createElement("img");
            img.className = "cover";
            img.src = b.coverImageURL || "https://via.placeholder.com/56x84?text=%20";
            img.alt = b.title || "Book";
            const right = document.createElement("div");
            const t = document.createElement("p");
            t.className = "book-title";
            t.innerText = b.title || "";
            const a = document.createElement("p");
            a.className = "book-author";
            a.innerText = b.author || "";
            right.appendChild(t);
            right.appendChild(a);
            el.appendChild(img);
            el.appendChild(right);
            container.appendChild(el);
          });
        });
    }).catch((err) => {
      console.error(err);
      document.getElementById("title").innerText = "Error loading list";
    });
  </script>
</body>
</html>
